<!DOCTYPE html>
<html>
<head>
  <style>
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;
      display:flex;justify-content:center;align-items:center;
      background:#ffe600;font-family:system-ui,sans-serif;
    }

    /* dialogs */
    .dialog{
      background:#fff;border:6px solid #000;
      padding:25px;text-align:center;
      box-shadow:8px 8px 0 #000;display:none;
    }
    .dialog.active{display:block}

    h1{margin:0 0 15px;text-transform:uppercase}

    /* inputs */
    button,select,input{
      padding:10px;margin-top:10px;
      border:4px solid #000;font-weight:bold;
      background:#ff5252;cursor:pointer;
    }
    button:hover{background:#ff1744}

    /* game */
    .container{
      background:#fff;border:6px solid #000;
      padding:20px;box-shadow:8px 8px 0 #000;
      display:none;
    }
    .stats{display:flex;justify-content:space-between;font-weight:bold}
    .grid{
      display:grid;
      grid-template-columns:repeat(3,120px);
      grid-template-rows:repeat(3,120px);
      gap:12px;margin-top:10px;
    }
    .cell{
      background:#e0f7fa;border:5px solid #000;
      display:flex;justify-content:center;align-items:center;
      font-size:42px;cursor:pointer;
    }
    .cell.mole::before{content:'ðŸ¦«'}
    .cell.hit::before{content:'ðŸ’¥'}
    .cell.mole-img img{width:85%;height:85%;object-fit:cover}

    /* weapon */
    #weapon{
      position:fixed;pointer-events:none;
      font-size:60px;display:none;
      transform:translate(-50%,-50%);
    }

    /* speech bubble */
    .bubble{
      position:absolute;background:#fff;
      border:3px solid #000;
      padding:6px 10px;font-weight:800;
      box-shadow:3px 3px 0 #000;
      animation:fade .8s forwards;
    }
    .bubble::after{
      content:'';position:absolute;
      bottom:-10px;left:15px;
      border:6px solid transparent;
      border-top-color:#000;
    }
    @keyframes fade{
      to{opacity:0;transform:translateY(-20px)}
    }
  </style>
</head>

<body>

<!-- start -->
<div class="dialog active" id="startBox">
  <h1>WHACK!</h1>

  <div><b>Choose your weapon</b></div>
  <select id="w">
    <option value="ðŸ©´"> Slipper</option>
    <option value="ðŸ—žï¸"> Rolling Pin</option>
    <option value="ðŸ¥–"> Bat</option>
  </select>

  <div style="margin-top:12px"><b>Upload your mole (optional)</b></div>
  <input type="file" id="img" accept="image/*">

  <br>
  <button onclick="start()">START GAME</button>
</div>


<!-- game -->
<div class="container" id="game">
  <div class="stats">
    <div>Score: <span id="s">0</span></div>
    <div>Time: <span id="t">30</span></div>
  </div>
  <div class="grid" id="g"></div>
</div>

<!-- end -->
<div class="dialog" id="endBox">
  <h1>GAME OVER</h1>
  <div>Score: <span id="fs"></span></div>
  <div>High: <span id="hs"></span></div>
  <button onclick="location.reload()">PLAY AGAIN</button>
</div>

<div id="weapon"></div>

<script>
let g=document.getElementById('g'),
s=document.getElementById('s'),
t=document.getElementById('t'),
weapon=document.getElementById('weapon'),
cells=[],score=0,time=30,active=false;
let timer,mole,hit=false,userImg=null;
let high=localStorage.whackHigh||0;
let words=['HAHAH!','OOPS!','TOO SLOW!','ðŸ˜’ðŸ˜’','ðŸ¤ª'];

for(let i=0;i<9;i++){
  let d=document.createElement('div');
  d.className='cell';
  d.onclick=()=>{
    if(!active) return;
    if(d.classList.contains('mole')||d.classList.contains('mole-img')){
      hit=true; score++; s.textContent=score;
      d.className='cell hit'; d.innerHTML='';
      weapon.style.transform='translate(-50%,-50%) rotate(-25deg)';
      setTimeout(()=>weapon.style.transform='translate(-50%,-50%)',150);
    }
  };
  g.append(d); cells.push(d);
}

document.onmousemove=e=>{
  weapon.style.left=e.clientX+'px';
  weapon.style.top=e.clientY+'px';
};

img.onchange=e=>{
  let r=new FileReader();
  r.onload=()=>userImg=r.result;
  r.readAsDataURL(e.target.files[0]);
};

function bubble(txt){
  let b=document.createElement('div');
  b.className='bubble'; b.textContent=txt;
  document.body.append(b);
  b.style.left=Math.random()*300+200+'px';
  b.style.top=Math.random()*200+200+'px';
  setTimeout(()=>b.remove(),2000);
}

function start(){
  document.getElementById('startBox').classList.remove('active');
  document.getElementById('game').style.display='block';
  weapon.textContent=w.value; weapon.style.display='block';
  score=0; time=30; active=true; s.textContent=0; t.textContent=30;

  timer=setInterval(()=>{
    if(--time<=0) end();
    t.textContent=time;
  },1000);

  mole=setInterval(()=>{
    if(!hit&& Math.random()<0.6) bubble(words[Math.floor(Math.random()*5)]); //60% chance
    hit=false;
    cells.forEach(c=>{c.className='cell'; c.innerHTML='';});
    let r=cells[Math.floor(Math.random()*9)];
    if(userImg){r.classList.add('mole-img'); r.innerHTML=`<img src="${userImg}">`;}
    else r.classList.add('mole');
  },700);
}

function end(){
  active=false; clearInterval(timer); clearInterval(mole);
  document.getElementById('game').style.display='none';
  document.getElementById('endBox').classList.add('active');
  fs.textContent=score;
  if(score>high){high=score; localStorage.whackHigh=high;}
  hs.textContent=high;
  weapon.style.display='none';
}
</script>
</body>
</html>
